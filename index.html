<html>
  <head>
    <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width">
    <meta name="description" content="A storage of my made musics.">
    <link rel="icon" href="https://truemaxdh.github.io/icon.png" type="image/png">
    <link rel="stylesheet" href="https://truemaxdh.github.io/Style/skin.css">
    <script>
      var list = [];
      var sounds = []; // sounds
      var curSndId = [0, 0];
      window.onload = function() {
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function() {
          if (this.readyState == 4) {
            if (this.status == 200) {
              
              // get list
              var tmp = this.responseText;
              var lines = tmp.split("\n");
              for (var i = 0; i < lines.length; i++) {
                if (lines[i].indexOf("## ") == 0) {
                  list.push([lines[i].substring(3)]);
                } else if (lines[i].indexOf(".mp3") > 0) {
                  list[list.length - 1].push(lines[i].substring(lines[i].indexOf(".mp3") + 6, lines[i].length - 1)) 
                }
              }
              
              console.log(tmp);
              console.log(lines);
              console.log(list);
              
              showList();
              //loadSound();
              
            } else {
              alert("failed to load data");
            }
          }
        }
        xhttp.open("GET", "/MusicTreasureHouse/README.md", true);
        xhttp.send();
      }
      
      function showList() {
        var board = document.getElementById("board");
        var strHtml = "<ul>";
        for (var i = 0; i < list.length; i++) {
          strHtml += "<li>" + list[i][0] + "<ul>";
          for (var j = 1; j < list[i].length; j++) {
            strHtml += "<li>" + list[i][j] + "</li>";
          }
          strHtml += "</ul></li>";
        }
        strHtml += "</ul>";
        board.innerHTML = strHtml;
      }           
      
      function startPlay2() {
        var player = document.getElementById("player");
        player.src = list[curSndId[0]][curSndId[1]+1];
        player.load();
        player.play();
      }
      
      function playNext() {
        if (++curSndId[1] >= (list[curSndId[0]].length) - 1) {
          curSndId[1] = 0;
          curSndId[0]++;
          if (curSndId[0] >= list.length) {
            curSndId[0] = 0;
          }
        }
        
        startPlay2();
      }
    </script>
  </head>
  <body>
    <div>
       <audio id="player" controls onended="playNext()" />
      <button onclick="startPlay2()">Play All</button>
    </div>
    <div id="board"></div>
    <!--Google AdSense -->
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <!-- AutoResponse -->
    <ins class="adsbygoogle"
         style="display:block"
         data-ad-client="ca-pub-7307479428475282"
         data-ad-slot="8718898251"
         data-ad-format="auto"></ins>
    <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
  </body>
</html>
